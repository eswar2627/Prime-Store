{% extends "base.html" %}
{% block title %}Order #{{ order.id }}{% endblock %}

{% block content %}
<div class="container mt-5 text-white">

    <!-- HEADER -->
    <h3 class="fw-bold">Order #{{ order.id }}</h3>
    <p class="text-muted">Placed on {{ order.created|date:"d M Y, h:i A" }}</p>

    <!-- Tracking Number -->
    {% if order.tracking_number %}
    <p class="text-white mt-3">
        <strong>Tracking Number:</strong> {{ order.tracking_number }}
    </p>
    {% endif %}

    <hr class="border-secondary">

    <!-- ITEMS -->
    <h4 class="fw-bold mb-3">Items</h4>

    {% for item in order.items.all %}
    <div class="d-flex mb-4 p-3 rounded"
         style="background: rgba(255,255,255,0.05);">

        <img src="{{ item.product.image.url }}"
             class="rounded"
             style="width:100px; height:100px; object-fit:cover;">

        <div class="ms-3">
            <h5 class="fw-bold text-white">{{ item.product.name }}</h5>
            <p class="mb-1 text-white">Quantity: {{ item.quantity }}</p>
            <p class="fw-bold text-white">₹{{ item.price }}</p>
        </div>
    </div>
    {% endfor %}

    <hr class="border-secondary">

    <!-- DELIVERY TIMELINE -->
    <h4 class="fw-bold mt-4 mb-3">Delivery Status</h4>

    <div class="timeline">

        <div class="step {% if order.status in 'PLACED PACKED SHIPPED OUT_FOR_DELIVERY DELIVERED' %}active{% endif %}">
            <div class="circle"></div>
            <span>Order Placed</span>
        </div>

        <div class="step {% if order.status in 'PACKED SHIPPED OUT_FOR_DELIVERY DELIVERED' %}active{% endif %}">
            <div class="circle"></div>
            <span>Packed</span>
        </div>

        <div class="step {% if order.status in 'SHIPPED OUT_FOR_DELIVERY DELIVERED' %}active{% endif %}">
            <div class="circle"></div>
            <span>Shipped</span>
        </div>

        <div class="step {% if order.status in 'OUT_FOR_DELIVERY DELIVERED' %}active{% endif %}">
            <div class="circle"></div>
            <span>Out for Delivery</span>
        </div>

        <div class="step {% if order.status == 'DELIVERED' %}active{% endif %}">
            <div class="circle"></div>
            <span>Delivered</span>
        </div>

    </div>

    <hr class="border-secondary">

    <!-- TOTAL -->
    <div class="d-flex justify-content-between mt-4">
        <h3 class="fw-bold">Total:</h3>
        <h3 class="fw-bold text-success">₹{{ order.get_total_cost }}</h3>
    </div>

    <!-- DOWNLOAD INVOICE -->
    <div class="mt-4">
        <a href="{% url 'orders:invoice' order.id %}" class="btn btn-outline-info w-100 fw-bold">
            Download Invoice
        </a>
    </div>

</div>


<!-- TIMELINE CSS -->
<style>
.timeline {
    display: flex;
    justify-content: space-between;
    margin-top: 25px;
    margin-bottom: 25px;
    position: relative;
}

.timeline::before {
    content: "";
    position: absolute;
    top: 19px;
    left: 0;
    width: 100%;
    height: 3px;
    background: rgba(255,255,255,0.2);
}

.step {
    text-align: center;
    position: relative;
    z-index: 2;
    width: 20%;
}

.circle {
    width: 18px;
    height: 18px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    margin: 0 auto 6px;
}

.step.active .circle {
    background: #0d6efd;
}

.step span {
    font-size: 14px;
    display: block;
    margin-top: 4px;
}
</style>

{% endblock %}
